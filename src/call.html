<!doctype html>
<html lang="en" style="-webkit-app-region: drag; background: var(--background-base-lowest);">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Incoming Call</title>
  <style>
    /* i am never doing normal css ever again i swear to god */
    *,
    *::before,
    *::after {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    html,
    body {
      background: var(--interactive-background-selected);
      overflow: hidden;
      user-select: none;
      -webkit-app-region: drag;
      width: 100%;
      height: 100%;
      font-family: "Inter", system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
    }

    .nodrag {
      -webkit-app-region: no-drag;
    }

    #incomingClose {
      position: absolute;
      top: 0;
      right: 0;
      padding: 8px;
      color: var(--text-muted, #AAABAD);
      cursor: pointer;
      transition: color 100ms, transform 100ms;
      line-height: 0;
    }

    #incomingClose:hover {
      color: var(--text-normal, #fff);
    }

    #incomingClose:active {
      transform: scale(0.9);
    }

    .call-layout {
      display: grid;
      grid-template-rows: auto auto auto;
      background: var(--background-base-lowest);
      padding: 0 12px;
      width: 100%;
      height: 100%;
    }

    .avatar-wrap {
      position: relative;
      display: flex;
      justify-content: center;
      align-items: center;
      margin-top: 24px;
      margin-bottom: 12px;
    }

    .avatar-pulse {
      position: absolute;
      z-index: 0;
      border: 3px solid var(--text-strong);
      border-radius: 50%;
      width: 96px;
      height: 96px;
    }

    #incomingPfp {
      position: relative;
      z-index: 1;
      border-radius: 50%;
      height: 88px;
      width: 88px;
      object-fit: cover;
    }

    .call-info {
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
    }

    #incomingUsername {
      padding: 0 1px;
      margin-bottom: 2px;
      width: 100%;
      overflow: hidden;
      font-weight: 600;
      color: var(--text-strong);
      font-size: 1.25rem;
      text-align: center;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
    }

    .call-subtitle {
      font-weight: medium;
      color: var(--text-muted, #AAABAD);
      font-size: 0.9rem;
    }

    .call-actions {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 20px;
    }

    .call-btn {
      display: flex;
      justify-content: center;
      align-items: center;
      border-radius: 50%;
      margin-bottom: 12px;
      width: 56px;
      height: 56px;
      color: var(--white-500, #fff);
      cursor: pointer;
      transition: background 100ms, transform 100ms;
      border: none;
      outline: none;
    }

    .call-btn:active {
      transform: scale(0.95);
    }

    #incomingDecline {
      background: var(--red-new-50);
    }

    #incomingDecline:hover {
      background: color-mix(in srgb, var(--red-new-50) 80%, transparent);
    }

    #incomingAnswer {
      background: var(--green-360);
    }

    #incomingAnswer:hover {
      background: color-mix(in srgb, var(--green-360) 80%, transparent);
    }

    @keyframes borderPulse {
      0% {
        transform: scale(0.95);
        opacity: 1;
        filter: blur(0);
      }

      100% {
        transform: scale(1.1);
        opacity: 0;
        filter: blur(1px);
      }
    }

    .border-pulse {
      animation: borderPulse 1.5s ease-out infinite;
    }
  </style>
</head>

<body>
  <div id="incomingClose" class="nodrag" role="button" aria-label="Close">
    <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
      <g>
        <g transform="translate(4 4)">
          <path
            d="M15.3107 13.3143L9.99633 8L15.5864 2.40993C15.8621 2.13419 16 1.80147 16 1.41177C16 1.02206 15.8621 0.689338 15.5864 0.413603C15.3107 0.137868 14.9779 0 14.5882 0C14.1985 0 13.8658 0.137868 13.5901 0.413603L8 6.00368L2.40993 0.413603C2.13419 0.137868 1.80147 0 1.41177 0C1.02206 0 0.689338 0.137868 0.413603 0.413603C0.137868 0.689338 0 1.02206 0 1.41177C0 1.80147 0.137868 2.13419 0.413603 2.40993L6.00368 8L0.413603 13.5901C0.137868 13.8658 0 14.1985 0 14.5882C0 14.9779 0.137868 15.3107 0.413603 15.5864C0.689338 15.8621 1.02206 16 1.41177 16C1.80147 16 2.13419 15.8621 2.40993 15.5864L8 9.99633L13.3143 15.3107C13.5901 15.5864 13.9228 15.7243 14.3125 15.7243C14.7022 15.7243 15.0349 15.5864 15.3107 15.3107C15.5864 15.0349 15.7243 14.7022 15.7243 14.3125C15.7243 13.9228 15.5864 13.5901 15.3107 13.3143Z"
            fill="currentColor" fill-rule="evenodd" />
        </g>
      </g>
    </svg>
  </div>

  <div class="call-layout">
    <div class="avatar-wrap">
      <div class="avatar-pulse border-pulse"></div>
      <img id="incomingPfp" src="assets/img/recar.png" alt="Avatar" />
    </div>

    <div class="call-info">
      <p id="incomingUsername">Username</p>
      <p class="call-subtitle">Incoming Call...</p>
    </div>

    <div class="call-actions">
      <button id="incomingDecline" class="call-btn nodrag" aria-label="Decline">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
          <g>
            <g transform="translate(4 4)">
              <path
                d="M15.3107 13.3143L9.99633 8L15.5864 2.40993C15.8621 2.13419 16 1.80147 16 1.41177C16 1.02206 15.8621 0.689338 15.5864 0.413603C15.3107 0.137868 14.9779 0 14.5882 0C14.1985 0 13.8658 0.137868 13.5901 0.413603L8 6.00368L2.40993 0.413603C2.13419 0.137868 1.80147 0 1.41177 0C1.02206 0 0.689338 0.137868 0.413603 0.413603C0.137868 0.689338 0 1.02206 0 1.41177C0 1.80147 0.137868 2.13419 0.413603 2.40993L6.00368 8L0.413603 13.5901C0.137868 13.8658 0 14.1985 0 14.5882C0 14.9779 0.137868 15.3107 0.413603 15.5864C0.689338 15.8621 1.02206 16 1.41177 16C1.80147 16 2.13419 15.8621 2.40993 15.5864L8 9.99633L13.3143 15.3107C13.5901 15.5864 13.9228 15.7243 14.3125 15.7243C14.7022 15.7243 15.0349 15.5864 15.3107 15.3107C15.5864 15.0349 15.7243 14.7022 15.7243 14.3125C15.7243 13.9228 15.5864 13.5901 15.3107 13.3143Z"
                fill="currentColor" fill-rule="evenodd" />
            </g>
          </g>
        </svg>
      </button>

      <button id="incomingAnswer" class="call-btn nodrag" aria-label="Answer">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
          <g>
            <path
              d="M0 5.4C0 2.41766 2.41766 0 5.4 0C5.76 0 6.1 0.22 6.23 0.55C6.23 0.55 8.16 5.19 8.16 5.19C8.35176 5.6555 8.16756 6.19098 7.73 6.44C7.73 6.44 5 8 5 8C5.59938 11.5886 8.41139 14.4006 12 15C12 15 13.12 12.76 13.12 12.76C13.3382 12.3215 13.842 12.1056 14.31 12.25C14.31 12.25 19.37 13.81 19.37 13.81C19.75 13.92 20 14.27 20 14.66C20 17.6 17.6 20 14.66 20C14.66 20 14.29 20 14.29 20C6.39 20 0 13.6 0 5.71C0 5.71 0 5.4 0 5.4ZM11 1C11 0.447716 11.4477 4.76837e-07 12 4.76837e-07C16.4183 4.76837e-07 20 3.58172 20 8C20 8.55229 19.5523 9 19 9C18.4477 9 18 8.55228 18 8C18 4.68629 15.3137 2 12 2C11.4477 2 11 1.55229 11 1Z"
              fill="currentColor" transform="translate(2 2)" />
            <path
              d="M0 1C0 0.447715 0.447715 0 1 0C3.20914 0 5 1.79086 5 4C5 4.55229 4.55228 5 4 5C3.44772 5 3 4.55228 3 4C3 2.89543 2.10457 2 1 2C0.447715 2 0 1.55228 0 1Z"
              fill="currentColor" transform="translate(13 6)" />
          </g>
        </svg>
      </button>
    </div>
  </div>
</body>

<script>
  function adjustCallHeightForName() {
    const el = document.getElementById("incomingUsername");
    if (!el) return;
    const originalClamp = el.style.webkitLineClamp;
    el.style.webkitLineClamp = "";
    const fullHeight = el.scrollHeight;
    el.style.webkitLineClamp = originalClamp;
    const computed = getComputedStyle(el);
    const lineHeight = parseFloat(computed.lineHeight) || 20;
    const lines = Math.round(fullHeight / lineHeight);
    const extra = lines >= 2 ? 28 : 0;
    if (window.electron && typeof window.electron.adjustCallHeight === "function") {
      window.electron.adjustCallHeight(extra);
    }
  }

  window.electron.onCallData((data) => {
    const el = document.getElementById("incomingUsername");
    if (data.username && el) {
      el.textContent = data.username;
      requestAnimationFrame(adjustCallHeightForName);
    }
    if (data.iconUrl)
      document.getElementById("incomingPfp").src = data.iconUrl;
  });

  document.getElementById("incomingClose").onclick = () => window.close();
  document.getElementById("incomingDecline").onclick = () => window.electron.dismissCall();
  document.getElementById("incomingAnswer").onclick = () => window.electron.answerCall();

  window.addEventListener("DOMContentLoaded", () => {
    requestAnimationFrame(adjustCallHeightForName);
  });
</script>

</html>